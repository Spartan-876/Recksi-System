<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dashboard</title>
        <!-- Bootstrap 5 CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
        />
        <!-- Google Font -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="icon"
            th:href="@{/imagen/icono-Recksi.jpg}"
            type="image/jpeg"
        />

        <link th:href="@{/css/main.css}" rel="stylesheet" />
        <style>
            .hover-shadow:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
            }
            .transition-all {
                transition: all 0.3s ease;
            }
        </style>
    </head>
    <body>
        <div class="d-flex">
            <div th:replace="~{sidebar :: sidebar(activeUri='/')}"></div>

            <div id="main-content" class="main-content w-100 bg-light">
                <header
                    class="p-3 mb-4 border-bottom bg-white shadow-sm sticky-top"
                >
                    <div
                        class="d-flex align-items-center justify-content-between"
                    >
                        <div class="d-flex align-items-center">
                            <button
                                id="open-sidebar"
                                class="btn btn-light d-md-none me-3 p-1 shadow-sm"
                            >
                                <i class="bi bi-list fs-4"></i>
                            </button>
                            <h1 class="h4 mb-0 fw-bold text-dark">Dashboard</h1>
                        </div>
                    </div>
                </header>

                <main class="container-fluid px-2">
                    <div
                        class="d-flex align-items-center mb-4 bg-light border rounded shadow-sm p-2"
                    >
                        <div
                            class="bg-secondary bg-opacity-10 p-2 rounded me-3"
                        >
                            <i class="bi bi-funnel-fill text-dark fs-4"></i>
                        </div>
                        <div>
                            <h2 class="h5 fw-bold mb-0 text-dark">
                                Flujo de Producción - Bidones de Agua
                            </h2>
                            <small class="text-muted"
                                >Estado actual de la línea de producción</small
                            >
                        </div>
                    </div>

                    <div
                        th:replace="~{::seccionEmbudo('Línea de Producción: AGUA (20L)', ${embudoAgua})}"
                    ></div>

                    <div class="card border-0 shadow mt-2">
                        <div
                            class="card-header bg-white py-3 d-flex justify-content-between align-items-center"
                        >
                            <h5 class="mb-0 fw-bold text-secondary">
                                <i class="bi bi-clock-history me-2"></i
                                >Actividad Reciente
                            </h5>
                            <a
                                th:href="@{/movimientoInventario/listar}"
                                class="btn btn-sm btn-outline-primary rounded-pill"
                            >
                                Ver todo
                            </a>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table
                                    class="table table-hover align-middle mb-0"
                                >
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="ps-4">Fecha/Hora</th>
                                            <th>Tipo</th>
                                            <th>Producto</th>
                                            <th>Almacenes</th>
                                            <th class="text-end pe-4">
                                                Cantidad
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr
                                            th:each="mov : ${ultimosMovimientos}"
                                        >
                                            <td
                                                class="ps-4 text-muted small"
                                                th:text="${#temporals.format(mov.fechaHora, 'dd-MM HH:mm')}"
                                            >
                                                12-10 14:30
                                            </td>

                                            <td>
                                                <span
                                                    class="badge rounded-pill"
                                                    th:classappend="${mov.tipoMovimiento.nombre.contains('Ingreso') ? 'bg-success' : 
                                                    (mov.tipoMovimiento.nombre.contains('Salida') ? 'bg-danger' : 'bg-warning text-dark')}"
                                                    th:text="${mov.tipoMovimiento.nombre}"
                                                >
                                                    TIPO
                                                </span>
                                            </td>

                                            <td>
                                                <span class="fw-bold text-dark">
                                                    <span
                                                        th:if="${mov.almacenDestino != null}"
                                                        th:text="${mov.almacenDestino.producto.nombre}"
                                                    ></span>
                                                    <span
                                                        th:if="${mov.almacenDestino == null}"
                                                        th:text="${mov.almacenOrigen.producto.nombre}"
                                                    ></span>
                                                </span>
                                            </td>

                                            <td class="small">
                                                <div
                                                    class="d-flex align-items-center"
                                                >
                                                    <span
                                                        th:if="${mov.almacenOrigen != null}"
                                                        th:text="${mov.almacenOrigen.nombre}"
                                                        class="text-muted"
                                                    ></span>
                                                    <span
                                                        th:if="${mov.almacenOrigen == null}"
                                                        class="badge bg-light text-dark border"
                                                        >Regreso</span
                                                    >

                                                    <i
                                                        class="bi bi-arrow-right mx-2 text-primary"
                                                    ></i>

                                                    <span
                                                        th:if="${mov.almacenDestino != null}"
                                                        th:text="${mov.almacenDestino.nombre}"
                                                        class="text-muted"
                                                    ></span>
                                                    <span
                                                        th:if="${mov.almacenDestino == null}"
                                                        class="badge bg-light text-dark border"
                                                        >Cliente</span
                                                    >
                                                </div>
                                            </td>

                                            <td
                                                class="text-end pe-4 fw-bold"
                                                th:text="${mov.cantidad}"
                                            >
                                                10
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div
                                th:if="${#lists.isEmpty(ultimosMovimientos)}"
                                class="text-center py-4 text-muted"
                            >
                                No hay movimientos registrados hoy.
                            </div>
                        </div>
                    </div>

                    <!--Fragmento reutilizable para los proccesos -->
                    <div
                        th:fragment="seccionEmbudo(titulo, listaDatos)"
                        class="mb-5"
                    >
                        <div class="row row-cols-1 row-cols-md-3 g-4">
                            <div class="col" th:each="etapa : ${listaDatos}">
                                <div
                                    class="card h-100 shadow border-0"
                                    th:classappend="'border-start border-5 border-' + ${etapa.colorBootstrap}"
                                >
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-start mb-3"
                                        >
                                            <div>
                                                <h6
                                                    class="text-uppercase text-muted fw-bold small"
                                                    th:text="${etapa.nombreEtapa}"
                                                >
                                                    ETAPA
                                                </h6>
                                                <h2
                                                    class="display-5 fw-bold mb-0 text-dark"
                                                    th:text="${etapa.cantidadActual}"
                                                >
                                                    0
                                                </h2>
                                                <small class="text-muted"
                                                    >Unidades</small
                                                >
                                            </div>
                                            <div
                                                class="p-3 rounded-circle bg-light"
                                            >
                                                <i
                                                    th:class="'bi ' + ${etapa.icono} + ' fs-4 text-' + ${etapa.colorBootstrap}"
                                                ></i>
                                            </div>
                                        </div>

                                        <div
                                            class="p-2 rounded bg-light d-flex justify-content-between align-items-center"
                                        >
                                            <div>
                                                <span
                                                    class="d-block small text-muted"
                                                    >Mínimo Req.</span
                                                >
                                                <span
                                                    class="fw-bold text-dark"
                                                    th:text="${etapa.stockMinimo}"
                                                    >0</span
                                                >
                                            </div>
                                            <span
                                                class="badge"
                                                th:classappend="'bg-' + ${etapa.colorBootstrap}"
                                                th:text="${etapa.estado}"
                                                >Estado</span
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
        <!-- Necesario para main.js -->
        <script th:src="@{/js/main.js}"></script>
        <!-- Script común para sidebar -->
    </body>
</html>
